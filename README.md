COMPUTER-SCIENCE-Capstone-PBL-AI-based-Malware-Analysis    
=============
컴퓨터소프트웨어캡스톤PBL(인공지능기반악성코드분석) / 임을규 교수님 / 2021년 1학기 (4-1)
-------------
--------
## 주제
### *인공지능 기반 악성 코드 분석*   
( 정상 & 악성 파일 분류기 )

----
## 모델
악성 & 정상파일에서 추출한 opcode 들을 전처리 하고 Wide ResNet 을 이용해 분류

----
## 사용
1. 파일의 opcode sequence 를 추출   
2. 데이터셋으로 미리 만들어둔 [TFidfVectorizer](https://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.text.TfidfVectorizer.html)
를 이용해 [Tri-gram -> TF-idf를 이용한 BOW](https://datascienceschool.net/03%20machine%20learning/03.01.03%20Scikit-Learn%EC%9D%98%20%EB%AC%B8%EC%84%9C%20%EC%A0%84%EC%B2%98%EB%A6%AC%20%EA%B8%B0%EB%8A%A5.html)
방식으로 벡터화   
3. Wide ResNet 통과 후 분류


--- 
## 정리
###과정   
####1. Step1
1. 01_analysis - 파일들이 어느 opcode 를 얼마나 가지는 분석, 각 파일의 길이 조사
2. 02_n_gram - 각각의 파일에서 opcode 를 n-gram(tri-gram) 으로 묶어서 저장
3. 03_vocab - 전체 파일을 조사해서 n-gram 으로 묶인 opcode 를 가지고 vocab 을 만듦   
   ```
   ex) op1, op2, op3 -> 첫번째 파일에서 나온 opcode 들   
        op%, op%+1, op%+2 -> %번째 파일에서 나온 opcode 들     
        {(op1,op2,op3):1, (op2,op3,op4):2 ..... (op%, op%+1, op%+2):***}
   ```
4. 04_whitelist - idf 값을 이용해 정상파일에서 많이 나오는 gram 을 whitelist 로 지정
5. 05_analysis_using_whitelist - whitelist 의 opcode 를 제거하고 난 뒤의 파일의 길이 조사, 모델의 input 차원 결정 
6. 06_file_encoder - 파일을 n-gram 으로 묶고 whitelist 의 gram 을 제거한 뒤 vocab 을 이용해 벡터화
7. 07_model - Wide ResNet 내부의 CNN 의 kernel 사이즈와 pooling 사이즈 변경 후 학습 & 테스트   
***=> input 의 차원이 너무 커 google colab 에서 학습 불가 </br></br>***

####2. Step2
* Step1의 70000 차원 input 을 줄이기 위해 Step2 진행 (Step1과 과정이 동일함) 
* 모든 opcode 가 아닌 x86 instruction 만 취급
* whitelist 작성 시 idf 의 threshold 값을 높여줌
* input 의 차원이 70000 -> 40000 로 줄어듦   
***=> 이 방법도 input 의 차원이 너무 커 google colab 에서 학습 불가 </br></br>***
    
####3. Step3
* TFidfVectorizer 를 이용해 파일을 벡터화한 후 Wide Resnet 으로 분류 </br></br>

### 결과
* Accuracy : ***87.2*** </br></br>

###결론
* input 을 적절히 벡터화 하는 방법을 찾지 못해 TFidfVectorizer 를 사용했는데 이렇게 벡터화 할 시
파일의 순서 정보를 잃어버려 CNN 의 local connectivity 를 제대로 사용하지 못한 것 같아 아쉽다. </br></br>
  
### 참고자료
[Wide ResNet](https://dnddnjs.github.io/cifar10/2018/10/24/pyramidnet/#wideresnet)   
[Wide ResNet code](https://github.com/dnddnjs/pytorch-cifar10/tree/master/wide_resnet)   
[TFidfVectorizer](https://datascienceschool.net/03%20machine%20learning/03.01.03%20Scikit-Learn%EC%9D%98%20%EB%AC%B8%EC%84%9C%20%EC%A0%84%EC%B2%98%EB%A6%AC%20%EA%B8%B0%EB%8A%A5.html)   
[TFidfVectorizer2](https://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.text.TfidfVectorizer.html)   

